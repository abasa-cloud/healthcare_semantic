semantic_models:
#-------------------------#
# Semantic for Fact table #
#-------------------------#
  - name: patient_mtr
    model: ref('fct_patient')
    description: "This table is used for all Appointment reporting related process."
   # primary_entity: patient_id #Required. 

    defaults:
      agg_time_dimension: full_date

    entities: 
      #- name: patient_appt_primary_key
      #  type: primary
      #  description: Required
      #  expr: patient_appt_primary_key

      - name: patient_id # Unique identifier for the appointment
        type: primary
        expr: patient_id 

      - name: date
        type: foreign
        expr: dim_date_key #Created during transfromation after ingestion. 

    dimensions: 
      - name: full_date
        type: time
        label: "Reference Date -testing-"
        type_params:
          time_granularity: day

      - name: termination_date
        type: time
        label: "Reference the termiantion date -testing-"
        type_params:
          time_granularity: day

    measures:
      - name: total_count_patient
        label: "Total Count of Patients"
        description: "Count of total patients including churn patients."
        agg: count_distinct
        expr: patient_id
        
      - name: total_churn_patient
        label: "Total count of patients that left."
        description: "Count of patients that churned."
        agg: count  # Ensure 'agg' is provided
        expr: case when churn = 'Yes' then patient_id else null end
 
#-------------------------#
# Semantic for date table #
#-------------------------#
  - name: date
    model: ref('dim_date_table')
    description: "Table used for tracking appointments dates."

    entities: 
      - name: date
        type: primary
        expr: date_key

    dimensions: 
      - name: dim_date_key
        type: categorical
        expr: dim_date_key
      - name: dim_full_date
        type: categorical 
        expr: full_date
      - name: dim_year
        type: categorical 
        expr: year
      - name: dim_month
        type: categorical
        expr: month
      - name: dim_day
        type: categorical 
        expr: day
      - name: dim_day_of_week
        type: categorical 
        expr: day_of_week
      - name: dim_day_name
        type: categorical 
        expr: day_name
      - name: dim_month_name
        type: categorical
        expr: month_name
      